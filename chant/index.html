<style>

	button { font-size: 20pt; margin: 10px; }
	button, p {
	  -webkit-user-select: none; /* disable selection/Copy of UIWebView */
	  -webkit-touch-callout: none; /* disable the IOS popup when long-press on a link */
	}
	#buttonDiv {
		/*position: absolute;
	  bottom: 10%;*/
		text-align: center;
	}
	#currentWordButton {
		min-width: 200px;
  }
	#mainWindow {

	}
	#fill{
		height:70%;
		overflow-y: scroll;
		padding: 50px 30px 0px 30px;
		/*color:white;*/
	}
	/* BASIC RESET */
	ul,ol,li,h1,h2,h3,h4,h5,h6,pre,form,body,html,p,blockquote,fieldset,input{margin:0; padding:0;}

	/* HTML ELEMENTS */
	body { font: 14px "Lucida Grande","Lucida Sans Unicode",Helvetica,Arial,Verdana,sans-serif;
	/*padding-bottom:200px;*/
	/*background-color: black;*/
}
	h1 { padding:60px 0 0 40px; }
	p,form { padding:10px 40px; }
	a { color:#999; text-decoration:none; }
	a:hover { text-decoration:underline; }
</style>


<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8"/>

    <!-- Set the viewport to show the page at a scale of 1.0, and make it non-scalable -->
    <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;"/>

    <!-- Make it fullscreen / hide the browser URL bar -->
    <meta name="apple-mobile-web-app-capable" content="yes" />


    <!--
        Give the status bar another colour
        Valid values for "content" are: "default" (white), "black" and "black-translucent"
        If set to "default" or "black", the content is displayed below the status bar. If set to
        "black-translucent", the content is displayed under the bar.
    -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <!--
        Add a Home icon.
        By default, Mobile Safari searches for a file named "apple-touch-icon.png" in the root directory of your website.
        If it can't find any image there, you can specify it using the code below. Make sure the image has a dimension
        of 114x114 and is a PNG file. The glossy finish and resizing for the different devices will be done automatically.

        In case you don't want the gloss applied, use "apple-touch-icon-precomposed" instead of "apple-touch-icon".
    -->
    <link rel="apple-touch-icon" href="images/startup.png" />

    <!--
        Add a splash screen / startup image.
        Take note this file exactly needs to be 320x460 for iPhone or 1004x768 for iPad, and is a PNG file.
        Also, this only works if "apple-mobile-web-app-capable" is set to "yes".
    -->
    <link rel="apple-touch-startup-image" href="images/startup.png" />

    <!--
        Prevent the user from elastic scrolling / rubber banding. Sadly, doesn't always work properly.
        For a more solid solution, check out ScrollFix ( https://github.com/joelambert/ScrollFix )
    -->
    <script>
    function BlockElasticScroll(event) {
        //event.preventDefault() ;
    }

    // In JavaScript, you can use "window.navigator.standalone" to detect wether
    // the page is being viewed on your website, or as a standalone application.

    // You can also the detect the device the user is using.
    // var isIPhone = navigator.userAgent.indexOf("iPhone") != -1 ;
    // var isIPod = navigator.userAgent.indexOf("iPod") != -1 ;
    // var isIPad = navigator.userAgent.indexOf("iPad") != -1 ;
    // var isIOs = isIPhone || isIPod || isIPad ;

    </script>

    <title>Chant</title>

</head>
<body ontouchmove="BlockElasticScroll(event);">
	<div id=mainWindow>
		<p id=fill></p>
	</div>
	<div id=buttonDiv>
		<button id="currentWordButton"></button>
	</div>






	<script type='application/javascript' src='fastclick.js'></script>
	<script type='application/javascript' src='directory.js'></script>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
	<script type='application/javascript' src='longclick.js'></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"></script>

	<script type="text/javascript">


		$(document).ready(function()  {
			var loopProcessId;
			var attachFastClick = Origami.fastclick;
			attachFastClick(document.body);

			function loadChant(chantId) {
				$.get("texts/"+chantId +".txt",function(data){
				//$.get("texts/4.txt",function(data){
					var chantLines = data.split("\n");
					var currentLineNumber = 0;
					var currentLineArray = chantLines[0].split(" ");
					var currentWordNumber = 0;
					var fireNextWord = function() {
						// END OF LINE CASE
						//console.log(currentLineArray);
						//console.log(currentLineNumber);
						//console.log(currentWordNumber);

						$("#fill").append(currentLineArray[currentWordNumber] + " ");
						//now scroll down
						var $d = $('#fill');
						$d.scrollTop($d.prop("scrollHeight"));

						if(++currentWordNumber >= currentLineArray.length) {
							if(++currentLineNumber >= chantLines.length) {
								//it's at end of file
								return endChant();
								// could do fun stuff here, like prompt to share (send link to same chant)
								// (or share text of chant to social media)
								// Or could show the options screen + next button + set repeat

							}
							else {
								//it's end of line, so add a <br> and reset
								$("#fill").append("<br>");
								currentLineArray = chantLines[currentLineNumber].split(" ");
								// handle the case of an empty line
								while(currentLineArray.length == 1 && (currentLineArray[0] == null || currentLineArray[0].length == 0)){
									$("#fill").append("<br>");
									if(typeof chantLines[++currentLineNumber] !== 'undefined') currentLineArray = chantLines[currentLineNumber].split(" ");
									else return endChant();

									// WARNING -- won't work well if it ends on an empty line!
									// for now, just avoid doing that in the text file
								}
								currentWordNumber = 0;
							}
						}
						//console.log("fill button with "+currentLineArray[currentWordNumber]);
						$("#currentWordButton").text(currentLineArray[currentWordNumber]);
					}

					//long press loop.
					$("#currentWordButton").longclick(100,function() {
						//keep global ref to the process id so we can kill it later
						loopProcessId = self.setInterval(fireNextWord, 100);
					});
					$("#currentWordButton").bind( "touchend mouseup",function(){
						if(loopProcessId) window.clearInterval(loopProcessId);
						else fireNextWord(); //this is the case where we're not looping, and they just tap once.
						loopProcessId = null;
					})

					//load first word
					$("#currentWordButton").text(currentLineArray[0]);
				});
			}

			//make the text itself refresh the page
			$("#fill").click(function(){
				if(confirm("refresh page?")) location.reload();
			});

			//pick a random chant
			// inherited from directory.js
			var selectedChant = Directory[Math.floor(Math.random()*Directory.length)];
			//selectedChant.id = 4; //for test
			loadChant(selectedChant.id);

			function endChant()
			{
				window.clearInterval(loopProcessId);
				$("#currentWordButton").hide().off();
				$("#buttonDiv").hide();
				$("#buttonDiv").append( $("<button>").addClass("tempButtons").text("Random").click(function()
						{
							location.reload();
						})
				);
				$("#buttonDiv").append($("<button>").addClass("tempButtons").text("Repeat").click(function() {
							//empty the divs, and reset.
							$("#currentWordButton").show();
							$("#fill").empty();
							$(".tempButtons").remove();
							loadChant(selectedChant.id);
				}));
				$("#buttonDiv").delay(500).fadeIn(1300);
			}

		});
	</script>


</body>
</html>
